<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>HostRegister</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <div class="container">
        <h2>HostRegister</h2>

        <!-- Display validation errors for user -->
        <div th:if="${#fields.hasErrors('host')}">
            <p th:each="error : ${#fields.errors('admin')}" th:text="${error}"></p>
        </div>

        <!-- Form for both user and credentials -->
        <form th:action="@{/registerHost}" method="post" onsubmit="return validateForm()">

            <!-- User Information Section -->
            <div>
                <label for="name">First Name</label>
                <!-- Make field readonly if OIDC user -->
                <input type="text" id="name" th:field="*{host.name}" th:readonly="${isOidc}" placeholder="Enter your first name" required>
                <p th:if="${#fields.hasErrors('host.name')}" th:errors="*{host.name}"></p>
            </div>

            <div>
                <label for="surname">Last Name</label>
                <!-- Make field readonly if OIDC user -->
                <input type="text" id="surname" th:field="*{host.surname}" th:readonly="${isOidc}" placeholder="Enter your last name" required>
                <p th:if="${#fields.hasErrors('host.surname')}" th:errors="*{host.surname}"></p>
            </div>

            <div>
                <label for="email">Email</label>
                <!-- Make field readonly if OIDC user -->
                <input type="email" id="email" th:field="*{host.email}" th:readonly="${isOidc}" placeholder="Enter your email" required>
                <p th:if="${#fields.hasErrors('host.email')}" th:errors="*{host.email}"></p>
            </div>
            
            <div>
                <label for="birthDate">Birth Date</label>
                <!-- Make field readonly if OIDC user (optional) -->
                <input type="date" id="birthDate" th:field="*{host.birthDate}" th:readonly="${isOidc}">
                <p th:if="${#fields.hasErrors('host.birthDate')}" th:errors="*{host.birthDate}"></p>
            </div>

            <!-- Company Field (wrapped in a div to show/hide) -->
            <div id="companyFieldDiv">
                <label for="company">Company (or Freelancer)</label>
                <input type="text" id="companyField" th:field="*{host.company.name}" placeholder="Company Name">
            </div>

            <!-- Freelancer Checkbox -->
            <div>
                <input type="checkbox" id="freelancerCheckbox" name="freelancerCheckbox" onclick="toggleFreelancer()">
                <label for="freelancerCheckbox">Check this box if working as a freelancer</label>
            </div>

            <!-- Credentials fields without model binding (shown only for non-OIDC users) -->
            <div th:if="${!isOidc}">
                <label for="username">Username</label>
                <input type="text" id="username" name="username" placeholder="Choose a username" required>
            </div>

            <div th:if="${!isOidc}">
                <label for="password">Password</label>
                <input type="password" id="password" name="password" placeholder="Choose a password" required>
            </div>

            <!-- Address Information Section -->
            <h3>Address Information</h3>
            <h4>not mandatory, but entering this information will be helpful to suggest facilities in the area where you live!</h4>

            <div>
                <label for="country">Country</label>
                <input type="text" id="country" th:field="*{host.address.country}" placeholder="Enter your country">
                <p th:if="${#fields.hasErrors('host.address.country')}" th:errors="*{host.address.country}"></p>
            </div>

            <div>
                <label for="state">State</label>
                <input type="text" id="state" th:field="*{host.address.state}" placeholder="Enter your state">
                <p th:if="${#fields.hasErrors('host.address.state')}" th:errors="*{host.address.state}"></p>
            </div>

            <div>
                <label for="city">City</label>
                <input type="text" id="city" th:field="*{host.address.city}" placeholder="Enter your city">
                <p th:if="${#fields.hasErrors('host.address.city')}" th:errors="*{host.address.city}"></p>
            </div>

            <div>
                <label for="postalCode">Postal Code</label>
                <input type="text" id="postalCode" th:field="*{host.address.postalCode}" placeholder="Enter your postal code">
                <p th:if="${#fields.hasErrors('host.address.postalCode')}" th:errors="*{host.address.postalCode}"></p>
            </div>

            <div>
                <label for="street">Street</label>
                <input type="text" id="street" th:field="*{host.address.street}" placeholder="Enter your street">
                <p th:if="${#fields.hasErrors('host.address.street')}" th:errors="*{host.address.street}"></p>
            </div>

            <div>
                <label for="number">Street Number</label>
                <input type="text" id="number" th:field="*{host.address.number}" placeholder="Enter your street number">
                <p th:if="${#fields.hasErrors('host.address.number')}" th:errors="*{host.address.number}"></p>
            </div>


            <!-- Submit Button -->
            <div>
                <button type="submit">Register</button>
            </div>

        </form>

        <div>
            <p>Already have an account? <a href="/login">Login here</a></p>
        </div>
    </div>

    <!-- Add a script to check for either company or freelancer -->
    <script>
        function validateForm() {
            const companyField = document.getElementById("companyField").value.trim();
            const freelancerChecked = document.getElementById("freelancerCheckbox").checked;
    
            if (companyField === "" && !freelancerChecked) {
                alert("Please enter a company name or select the freelancer checkbox.");
                return false;
            }
            return true;
        }
    </script>
</body>
</html>
